Driver Code
===========

This folder contains the driver code to be run on an STM32. Many files are autogenerated by the IDE, and
therefore there is a lot code. All the (non-generated) application code is under the folder `Code`, written
in C++.

Highlighted files:
```ini
.
├── Code
│   ├── Inc
│   │   ├── app_main.hpp         # Main application entry point.
│   │   └── interrupts.hpp       # Interrupt handler definitions.
│   └── Src
│       ├── app_main.cpp         # After initialization the main app loop only handles comms and timekeeping.
│       │
│       └── interrupts.cpp       # Motor control logic! All motor control logic runs in the interrupt loop with
│                                # internal message passing to the main loop for data readouts and new commands.
│                                # 
│                                # We run a lot of code in the interrupts because motor control is the critical 
│                                # function of this driver chip. We do what we must because we can! The interrupt
│                                # is triggered when the ADC measures a set of phase currents. We must immediately
│                                # do math to transform the currents into the DQ0 frame and use those calculations
│                                # to set the motor PWM outputs for the upcoming cycle.
│
├── Core
│   └── Src
│       ├── main.c               # Invokes the app_main functions, otherwise it is autogenerated.
│       ├── stm32f1xx_it.c       # Invokes the interrupts, also autogenerated.
└── USB_DEVICE
    └── App
        └── usbd_cdc_if.c        # Invokes the USB send and receive functions, autogenerated.
```

New STM32 setup procedure
-------------------------

Install `STM32 Cube IDE / STM32 Cube MX`

Open `hex-mini-driver.ioc` and use the `Generate Code` tool from the STM32 Cube IDE.

After generating the blank code we need to make the following changes:
    1. Make sure it compiles... The CMakeFiles are generated once and then left to the user to edit, we must include all sources.


TODO: install procedure
TODO: compile procedure
TODO: upload procedure
TODO: control interface description
TODO: update the file descriptions above